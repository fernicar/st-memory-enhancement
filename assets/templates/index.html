<div class="memory_enhancement_container">
    <div class="memory_enhancement_settings">
        <div class="inline-drawer">
            <div id="inline_drawer_header_content">
                <b style="font-size: 1.1rem" data-i18n="Memory Enhancement (Tables)">Memory Enhancement (Tables)</b>
                <span id="tableUpdateTag" style="cursor: pointer; background-color: #41b68188" data-i18n="Click to update">Click to update</span>
            </div>

            <div class="inline-drawer-content">
                <div id="memory_enhancement_settings_inline_drawer_content">
                    <!-- Memory enhancement table management -->
                    <div style=" display: flex; flex-direction: row; justify-content: space-between; ">
                        <div style=" display: flex; flex-direction: row; gap: 10px;">
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-brands fa-github fa-lg"></i>
                                <a href="https://github.com/muyoou/st-memory-enhancement/" data-i18n="Project link">Project link</a>
                            </div>
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-solid fa-book"></i>
                                <a href="https://muyoo.com.cn/wiki/memory/start.html" data-i18n="Read tutorial">Read tutorial</a>
                            </div>
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-solid fa-list"></i>
                                <a href="https://github.com/muyoou/st-memory-enhancement/releases" data-i18n="Changelog">Changelog</a>
                            </div>
                        </div>
                        <div class="menu_button_icon menu_button interactable" id="table_debug_log_button">
                            <i class="fa-solid fa-bug"></i>
                            <a data-i18n="Logs">Log</a>
                        </div>
                    </div>
                    <div id="table_message_tip"></div>


                    <!--                        <hr/>-->

                    <!-- Child settings -->
                    <div class="persona_management_left_column flex-container wide100p flexGap10" style="padding: 10px 0; gap: 10px">
                        <div class="flex1 wide50p" style="min-width: 300px">

                            <!-- Basic settings -->
                            <div>
                                <h4 class="standoutHeader" data-i18n="Plugin settings">Plugin settings</h4>
                                <div class="checkbox_label flex-container wide100p" style="justify-content: space-between; align-items: center">
                                    <h4 data-i18n="Import, export and reset plugin">Import, export and reset plugin</h4>
                                    <div class="flex-container">
                                        <div class="menu_button button-square-icon fa-solid fa-file-import" id="table-set-import" title="Import table presets" data-i18n="[title]Import table presets"></div>
                                        <!--                                        <input type="file" id="table-set-importFile" accept=".json" hidden>-->
                                        <div class="menu_button button-square-icon fa-solid fa-file-export" id="table-set-export" title="Export table presets" data-i18n="[title]Export table presets"></div>
                                        <div class="menu_button button-square-icon fa-solid fa-undo" id="table-reset" title="Reset table presets" data-i18n="[title]Reset table presets"></div>
                                    </div>
                                </div>

                                <h4 data-i18n="Plugin switches">Plugin switches</h4>
                                <div class="checkbox_label">
                                    <input type="checkbox" id="table_switch"><span data-i18n="Enable plugin">Enable plugin</span>
                                </div>
                                <!--                                <div class="checkbox_label">-->
                                <!--                                    <input type="checkbox" id="table_switch_creator_mode"><span>Creator mode</span>-->
                                <!--                                </div>-->
                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="table_switch_debug_mode"><span data-i18n="Debug mode">Debug mode</span>
                                    <small class="toggle-description justifyLeft" data-i18n="Debug mode description">(Enabling it will cause some performance loss, only for code development and debugging)</small>
                                </div>

                                <div style="padding-left: 5px;">
                                    <label for="dataTable_message_template" data-i18n="Message template">Message template</label>
                                    <small class="toggle-description justifyLeft" data-i18n="Message template description">(Used to explain to the AI how to use and modify the table, use the <code>{{tableData}}</code> macro to select the insertion position of the table data)</small>
                                    <textarea id="dataTable_message_template" class="wide100p" rows="8"></textarea>
                                </div>

                                <div class="inline-drawer wide100p">
                                    <div class="inline-drawer-toggle inline-drawer-header">
                                        <h4 data-i18n="Custom independent API">Custom independent API</h4>
                                        <div class="fa-solid inline-drawer-icon interactable up fa-circle-chevron-up" tabindex="0"></div>
                                    </div>
                                    <div class="inline-drawer-content" style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                        <!-- Custom API settings -->
                                        <input type="text" id="custom_api_url" class="text_pole" placeholder="API URL (please end with /v1)">
                                        <input type="password" id="custom_api_key" class="text_pole" placeholder="API Key (multiple keys separated by commas)">
                                        <input type="text" id="custom_model_name" class="text_pole" placeholder="Model Name (can be entered manually or obtained automatically)">
                                        <div class="range-block justifyLeft" >
                                            <select id="model_selector" class="text_pole">
                                                <option value="">Please get the model list first</option>
                                            </select>
                                            <div class="menu_button menu_button_icon" id="fetch_models_button">
                                                <a>Get model list</a>
                                            </div>
                                            <div class="menu_button menu_button_icon" id="table_test_api_button" style="margin-left: 5px;">
                                                <a>Test</a>
                                            </div>
                                        </div>
                                        <div class="flex-container slider-container" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                            <label style="min-width: 140px; margin: 0; white-space: nowrap; flex-shrink: 0;" data-i18n="Custom API temperature setting">Custom API temperature setting: <span id="custom_temperature_value">1.0</span></label>
                                            <input type="range" id="custom_temperature" min="0.1" max="2.0" step="0.1" value="1.0" style="flex-grow: 1;">
                                        </div>

                                        <!-- Proxy settings -->
                                        <div class="inline-drawer wide100p">
                                            <div class="inline-drawer-toggle inline-drawer-header">
                                                <h4 data-i18n="Proxy settings">Proxy settings<span style="color: red">(Unfinished, not usable, please leave blank)</span></h4>
                                                <div class="fa-solid inline-drawer-icon interactable up fa-circle-chevron-up" tabindex="0"></div>
                                            </div>
                                            <div class="inline-drawer-content" style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                                <input type="text" id="table_proxy_address" class="text_pole" placeholder="Proxy address (e.g., http://127.0.0.1:7890)" data-i18n="[placeholder]Proxy address (e.g., http://127.0.0.1:7890)">
                                                <input type="password" id="table_proxy_key" class="text_pole" placeholder="Proxy key (optional)" data-i18n="[placeholder]Proxy key (optional)">
                                            </div>
                                        </div>

                                        <div class="m-b-1"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Table presets -->
                            <div>
                                <!-- Preset settings -->
                                <h4 class="standoutHeader" data-i18n="Run strategy">Run strategy</h4>
                                <label for="fill_table_time" data-i18n="Render to">Table filling behavior occurs in:</label>
                                    <select id="fill_table_time" class="flex1" style="min-width: 100px">
                                        <option value="chat">Fill table while chatting</option>
                                        <option value="after">Fill table separately after receiving message</option>
                                    </select>
                                

                                <!-- Default not to fill table step by step -->
                                <div id="reply_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <div style="height: 5px;"></div>
                                    <!-- Step-by-step table filling -->
                                    <div class="checkbox_label">
                                        <input type="checkbox" id="table_read_switch"><span data-i18n="AI read table switch">AI read table switch</span>
                                    </div>
                                    <div class="checkbox_label">
                                        <input type="checkbox" id="table_edit_switch"><span data-i18n="AI edit table switch">AI edit table switch</span>
                                    </div>
                                    <!-- Advanced settings options -->
                                    <div style="padding-left: 5px;">
                                        <div style=" display: flex;">
                                            <label for="dataTable_injection_mode" style="min-width: 50px" data-i18n="Injection">Injection:</label>
                                            <select id="dataTable_injection_mode">
                                                <option value="injection_off" data-i18n="Turn off injection">Turn off injection</option>
                                                <option value="deep_system">@D ⚙</option>
                                                <option value="deep_user">@D 👤</option>
                                                <option value="deep_assistant">@D 🤖</option>
                                            </select>
                                            <label style="min-width: 60px; padding-left: 10px; " for="dataTable_deep" data-i18n="Depth">Depth:</label>
                                                <input class="text_pole wideMax100px margin0" type="number" id="dataTable_deep">
                                        </div>
                                    </div>
                                    
                                </div>

                                <!-- Step-by-step table filling -->
                                <div id="step_by_step_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <div class="checkbox_label" style="display: flex; align-items: center;">
                                        <input type="checkbox" id="step_by_step_use_main_api" checked><span data-i18n="Use main API">Use main API</span>
                                        <div class="menu_button menu_button_icon" id="trigger_step_by_step_button" style="margin-left: 10px;">
                                            <i class="fa-solid fa-play"></i><a data-i18n="Fill now">Fill now</a>
                                        </div>
                                        <label for="separateReadContextLayers" style="margin-left: 10px;">Context layers</label>
                                        <input type="number" id="separateReadContextLayers" class="margin0 text_pole" style="width: 50px;" min="1" value="1"/>
                                        <label for="separateReadLorebook" style="margin-left: 10px;">Read lorebook</label>
                                        <input type="checkbox" id="separateReadLorebook" class="margin0"/>
                                        <small class="toggle-description justifyLeft">(Not recommended for large Token cards)</small>
                                    </div>
                                    <div style="padding-left: 5px; margin-bottom: 10px;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <label for="step_by_step_user_prompt" data-i18n="settings.label.stepByStepUserPrompt">Independent table filling overall structure</label>
                                            <div class="menu_button button-square-icon fa-solid fa-undo" id="reset_step_by_step_user_prompt" title="Reset to default" data-i18n="[title]Reset to default"></div>
                                        </div>
                                        <small class="toggle-description justifyLeft" data-i18n="settings.hint.stepByStepUserPrompt">(When filling the table independently, the request will be sent in this structure, please keep it parsable by json)</small>
                                        <textarea id="step_by_step_user_prompt" class="text_pole settings_textarea wide100p" rows="8" placeholder="Enter independent table filling prompt"></textarea>
                                    </div>
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="confirm_before_execution" checked><span data-i18n="Confirm before execution">Confirm before execution</span>
                                        <small class="toggle-description justifyLeft" data-i18n="Confirm before execution description">(A confirmation box will pop up when the independent table filling process encounters a check node)</small>
                                    </div>
                                </div>

                                <div class="m-b-1"></div>
                            </div>
                            <!--                        <hr/>-->
                        </div>

                        <div class="flex1 wide50p" style="min-width: 300px">
                            <!-- Reorganize tables -->
                            <div  class="inline-drawer wide100p">
                                <div class="standoutHeader inline-drawer-toggle inline-drawer-header">
                                    <b><span data-i18n="Reorganize tables">Table Summary/Reorganization</span></b>
                                    <div class="fa-solid fa-circle-chevron-down inline-drawer-icon down"></div>
                                </div>
                                <div class="inline-drawer-content" style="display: none; ">
                                    <div class="checkbox_label">
                                        <input type="checkbox" id="use_main_api" checked><span data-i18n="Use main API">Use main API</span>
                                    </div>

                                    <!-- Advanced settings options -->
                                    <!-- <div class="flex-container slider-container" style="margin: 5px; padding-bottom: 10px;" id="clear_up_stairs_container">
                                        <label><span data-i18n="Reference recent chat history">Reference recent chat history:</span><code id="clear_up_stairs_value">9 messages</code></label>
                                        <input type="range" id="clear_up_stairs" min="1" max="99" step="1" value="9" style="width: calc(100% - 20px);">
                                    </div> -->
                                    <div class="flex-container slider-container" style="margin: 5px; padding-bottom: 10px" id="token_limit_container">
                                        <label><span data-i18n="Token limit">Token limit:</span><code id="rebuild_token_limit_value">10000</code></label>
                                        <input type="range" id="rebuild_token_limit" min="1000" max="100000" step="1000" value="10000" style="width: calc(100% - 20px);">
                                    </div>
                                    <!-- Blocked option, changed to default token limit -->
                                    <!-- <div class="checkbox_label">
                                        <input type="checkbox" id="use_token_limit"><span data-i18n="Use token limit instead of chat history limit">Use token limit instead of chat history limit</span>
                                    </div> -->
                                    <div class="checkbox_label">
                                        <input type="checkbox" id="ignore_user_sent" checked><span data-i18n="Only reference AI replies">Only reference AI replies</span>
                                    </div>
                                    <div class="checkbox_label">
                                        <input type="checkbox" id="bool_silent_refresh"><span data-i18n="Skip confirmation dialog after reorganizing">Skip confirmation dialog after reorganizing</span>
                                    </div>

                                    <div class="flex-container" style="flex-wrap: nowrap; padding-top: 10px;">
                                        <b style="width: 170px;">Summary Template</b>
                                        <select id="rebuild--select">
                                        </select>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-pencil" id="rebuild--set-rename" title="Edit summary template"></div>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-plus" id="rebuild--set-new" title="Create summary template"></div>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-file-import" id="rebuild--set-import" title="Import summary template"></div>
                                        <input type="file" id="rebuild--set-importFile" accept=".json" hidden>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-file-export" id="rebuild--set-export" title="Export summary template"></div>
                                        <div class="rebuild--del menu_button menu_button_icon fa-solid fa-trash redWarningBG" id="rebuild--set-delete" title="Delete this template"></div>
                                    </div>

                                    <div style="display: flex; width: calc(100% - 20px);">
                                        <div class="menu_button menu_button_icon" id="table_clear_up">
                                            <i class="fa-solid fa-repeat"></i><a data-i18n="Reorganize tables now">Reorganize tables now</a>
                                        </div>
                                    </div>
                                </div>

                                <div class="m-b-1"></div>
                            </div>
                            <!--                        <hr/>-->

                            <!-- Push table to chat -->
                            <div class="flex1 wide100p">
                                <h4 class="standoutHeader" data-i18n="Frontend table (status bar)">Frontend table (status bar)</h4>
                                <!--                            <b class="table_setting_category_header">Push table to chat</b><div style="height: 10px;"></div>-->
                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="show_settings_in_extension_menu" checked><span data-i18n="Access tables from extensions menu">Access tables from extensions menu</span>
                                </div>
                                <!--                                <div class="checkbox_label range-block justifyLeft unfinished">-->
                                <!--                                    <input type="checkbox" id="show_drawer_in_extension_list" checked><span>Show table settings in extension list</span>-->
                                <!--                                </div>-->

                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="table_to_chat"><span data-i18n="Render table view in conversation">Render table view in conversation</span>
                                    <small class="toggle-description justifyLeft" data-i18n="Render table view in conversation description">(After enabling, a custom table will be displayed in the dialog box)</small>
                                </div>

                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="alternate_switch" checked><span data-i18n="Render table view in alternate model">Alternating mode</span>
                                    <small class="toggle-description justifyLeft" data-i18n="Render table view in alternate model description">(After enabling, the alternating rendering mode will be enabled in the dialog box)</small>
                                </div>


                                <!-- Push table to chat -->
                                <div id="table_to_chat_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <!-- TODO: This needs to be implemented<div class="checkbox_label range-block justifyLeft unfinished">
                                        <input type="checkbox" id="table_to_chat_can_edit"><span data-i18n="Data editable">Data editable</span>
                                        <small class="toggle-description justifyLeft" data-i18n="Data editable description">(Data can be edited in the table rendered in the conversation)</small>
                                    </div> -->

                                    <div class="checkbox_label range-block justifyLeft">
                                        <label for="table_to_chat_mode" data-i18n="Render to">Render to</label>
                                        <select id="table_to_chat_mode" class="flex1" style="min-width: 100px">
                                            <option value="context_bottom" data-i18n="Bottom of context">Bottom of context</option>
                                            <option value="last_message" data-i18n="Inside last message">Inside last message</option>
                                            <!--                                            <option value="macro">Custom location (macro)</option>-->
                                        </select>
                                        <small id="table_to_chat_is_micro_d" class="toggle-description justifyLeft" data-i18n="Use custom display location">Use <code>{{sheetsView}}</code> to customize the display location</small>
                                    </div>

                                    <div class="menu_button menu_button_icon" id="dataTable_to_chat_button" style="margin-top: 10px">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i><a data-i18n="Edit style of tables rendered in conversation">Edit style of tables rendered in conversation</a>
                                    </div>
                                </div>

                                <!-- Advanced settings -->
                                <div class="inline-drawer wide100p">
                                    <div class="inline-drawer-toggle inline-drawer-header">
                                        <h4 data-i18n="Advanced rendering settings">Advanced rendering settings</h4>
                                        <div class="fa-solid inline-drawer-icon interactable up fa-circle-chevron-up" tabindex="0"></div>
                                    </div>
                                    <div class="inline-drawer-content" style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                        <!-- Advanced settings options -->
                                        <div class="checkbox_label range-block justifyLeft">
                                            <label for="table_cell_width_mode" data-i18n="Render to">Cell display</label>
                                            <select id="table_cell_width_mode" class="flex1" style="min-width: 100px">
                                                <option value="single_line">No wrap</option>
                                                <option value="wide1_cell">Wide</option>
                                                <option value="wide1_2_cell">Half-width</option>
                                                <option value="wide1_4_cell">1/4 width</option>
                                            </select>
                                            <small id="table_to_chat_is_micro_d" class="toggle-description justifyLeft">Cell display method for all tables</small>
                                        </div>
                                        <div class="checkbox_label range-block justifyLeft">
                                            <input type="checkbox" id="high_performance_sheets_render"><span data-i18n="Disable dynamic effects in table plugin">Disable dynamic effects in table plugin</span>
                                            <small class="toggle-description justifyLeft" data-i18n="Disable dynamic effects description">(If you experience lag after enabling the plugin, you can try enabling this)</small>
                                        </div>
                                        <div class="checkbox_label range-block justifyLeft">
                                            <input type="checkbox" id="gpu_assist_sheets_render"><span data-i18n="Disable GPU table rendering">Disable GPU table rendering</span>
                                            <small class="toggle-description justifyLeft" data-i18n="Disable GPU table rendering description">(Manually disable GPU rendering for tables)</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="m-b-1"></div>
                                <hr>
                            </div>
                            <!--                        <hr/>-->
                        </div>
                    </div>

                    <div style="height: 10px;"></div>
                </div>
            </div>
        </div>
    </div>

</div>
